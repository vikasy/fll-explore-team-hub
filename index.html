<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WV FLL Explore Team 2 aka FLLEX2WV Hub</title>
  <!--
    This simple static portal provides a central hub for a FIRST LEGO League Explore team.
    It loads a season timeline and a roster from CSV files in the same directory and
    presents them in a table. A lightweight to‑do list uses the browser's localStorage
    to store tasks. Replace the placeholder in the calendar section with an embedded
    Google Calendar iframe to show your team's schedule.
  -->
  <style>
    :root {
      --primary-color: #0052a3;
      --secondary-color: #e7f1ff;
      --light-bg: #f5f5f5;
      --border-color: #dddddd;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--light-bg);
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: var(--primary-color);
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    main {
      flex: 1;
      padding: 1rem;
      /*
        Set a flexible width so the layout shrinks on small screens.  On larger
        displays the content is constrained to 1000px, but on phones and tablets
        it can collapse down to 100% of the viewport width.
      */
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
    }
    section {
      margin-bottom: 2rem;
    }
    h2 {
      margin-top: 0;
      color: var(--primary-color);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    th,
    td {
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      text-align: left;
    }
    th {
      background-color: var(--secondary-color);
      font-weight: bold;
    }
    /* Task list styling */
    #task-list {
      list-style: none;
      padding: 0;
    }
    #task-list li {
      background: #fff;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #task-list li button {
      background: var(--primary-color);
      color: #fff;
      border: none;
      padding: 0.25rem 0.5rem;
      cursor: pointer;
    }
    #task-input {
      padding: 0.5rem;
      width: 70%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
    }
    #task-add {
      padding: 0.5rem 1rem;
      margin-left: 0.5rem;
      background: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  
    /* Responsive adjustments for small screens */
    @media (max-width: 600px) {
      #task-input {
        width: 100%;
        margin-bottom: 0.5rem;
      }
      #task-add {
        width: 100%;
        margin-left: 0;
      }
      iframe {
        height: 400px;
      }
    }
</style>
</head>
<body>
  <header>
    <h1>West Valley Elementary FLL Explore Team 2 [FLLEX2WV] Hub</h1>
  </header>
  <main>
    <section id="welcome">
      <!-- The illustration is loaded from the repository root as team_cartoon.png -->
      <img src="team_cartoon.png" alt="Kids building a robot" style="max-width:100%;height:auto;display:block;margin:0 auto 1rem;" />
      <p style="text-align:center;font-size:1.2rem;">West Valley Elementary FIRST LEGO League </p>
      <p style="text-align:center;font-size:1.2rem;"> Explore Team #2 aka FLLEX2WV </p>
      <p style="text-align:center;">
        Our school: 
        <a href="https://westvalley.cusdk8.org" target="_blank" style="color: var(--primary-color); text-decoration: underline;">
          West Valley Elementary School
        </a>
      </p>
      <!-- Easy link to access this portal -->
      <p style="text-align:center;">
        Simple URL:
        <a href="https://westvalley.short.gy/fllexplore" target="_blank" style="color: var(--primary-color); text-decoration: underline;">
          westvalley.short.gy/fllexplore
        </a>
      </p>
    </section>
    <section id="timeline">
      <h2>Season Timeline</h2>
      <div id="timeline-container">Loading timeline…</div>
    </section>
    <!-- Inserted Team Calendar after Timeline -->
    <section id="calendar">
      <h2>Team Calendar</h2>
      <div style="background:#fff;border:1px solid var(--border-color);padding:1rem;text-align:center;">
        <iframe src="https://calendar.google.com/calendar/embed?src=fll2025.westvalley.cusdk8%40gmail.com&ctz=America%2FLos_Angeles" style="border:0; width:100%; height:600px;" frameborder="0" scrolling="no"></iframe>
      </div>
    </section>
    <section id="roster">
      <h2>Team Roster</h2>
      <div id="roster-container">Loading roster…</div>
    </section>
    <section id="tasks">
      <h2>Team To‑Dos</h2>
      <div>
        <input type="text" id="task-input" placeholder="Add a new task" />
        <button id="task-add">Add</button>
      </div>
      <ul id="task-list"></ul>
    </section>

    <!-- Team media section linking to a private Google Drive folder -->
    <section id="media">
      <h2>Team Media (Photos & Videos)</h2>
      <p>
        Our team photos and videos are stored in a private Google Drive folder.
        Click the link below to view them. You may need to be signed in to the
        team Google account or have been granted access to the folder.
      </p>
      <p>
        <a
          href="https://drive.google.com/drive/folders/1b19vrBw2hnJooXG8DEQJfJXdDpgWjdrF?usp=share_link"
          target="_blank"
          style="color: var(--primary-color); text-decoration: underline;"
        >
          Team Media Folder
        </a>
      </p>
    </section>
      <!-- Financials subsection -->
      <section id="financials">
        <h2>Financials</h2>
        <ul>
          <li>
            <a href="money_matters/FLLEX2WV_Registration_Fee.jpeg" target="_blank" style="color: var(--primary-color); text-decoration: underline;">
              Registration Fee Receipt
            </a>
          </li>
          <!-- Add more items here as needed -->
        </ul>
      </section>
    <!-- Calendar section moved above, removed original -->
  </main>
  <script>
    function buildTable(rows, containerId) {
      if (!rows || rows.length === 0) return;
      const container = document.getElementById(containerId);
      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      rows[0].forEach((cell) => {
        const th = document.createElement('th');
        th.textContent = cell;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);
      const tbody = document.createElement('tbody');
      for (let i = 1; i < rows.length; i++) {
        const tr = document.createElement('tr');
        rows[i].forEach((cell) => {
          const td = document.createElement('td');
          td.textContent = cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      }
      table.appendChild(tbody);
      container.innerHTML = '';
      container.appendChild(table);
    }
    fetch('fll_explore_timeline_2025_26.csv')
      .then((response) => response.text())
      .then((text) => {
        const rows = text.trim().split('\n').map((line) => line.split(','));
        buildTable(rows, 'timeline-container');
      })
      .catch(() => {
        document.getElementById('timeline-container').textContent =
          'Could not load timeline.';
      });
    fetch('fll_roster_template.csv')
      .then((response) => response.text())
      .then((text) => {
        const rows = text.trim().split('\n').map((line) => line.split(','));
        buildTable(rows, 'roster-container');
        // After building the roster table, convert email cells into mailto links
        // and provide a convenient "Email all parents" link. This enhances
        // communication among team parents while keeping the site static.
        const rosterContainer = document.getElementById('roster-container');
        const table = rosterContainer.querySelector('table');
        if (table) {
          const emails = [];
          const bodyRows = table.querySelectorAll('tbody tr');
          bodyRows.forEach((tr) => {
            // Assume the third column (index 2) holds the parent email
            const emailCell = tr.cells[2];
            if (emailCell) {
              const email = emailCell.textContent.trim();
              if (email) {
                emailCell.innerHTML = '<a href="mailto:' + email + '">' + email + '</a>';
                emails.push(email);
              }
            }
          });
          if (emails.length > 0) {
            const p = document.createElement('p');
            p.style.marginTop = '0.5rem';
            const link = document.createElement('a');
            link.href = 'mailto:' + emails.join(',');
            link.textContent = 'Email all parents';
            link.style.color = 'var(--primary-color)';
            link.style.textDecoration = 'underline';
            p.appendChild(link);
            rosterContainer.appendChild(p);
          }
        }
      })
      .catch(() => {
        document.getElementById('roster-container').textContent =
          'Could not load roster.';
      });

    // --- Server-based To-Do List Implementation ---
  const API_URL = 'https://fllex2wv.wm.r.appspot.com/api/tasks';



    async function fetchTasks() {
      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error('Failed to fetch tasks: ' + res.status);
        const data = await res.json();
        console.log('Fetched tasks:', data);
        return data;
      } catch (e) {
        console.error('Error fetching tasks:', e);
        alert('Error fetching tasks: ' + e.message);
        return [];
      }
    }

    async function postTask(task) {
      try {
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ task })
        });
        if (!res.ok) throw new Error('Failed to add task: ' + res.status);
        const data = await res.json();
        console.log('Task added successfully:', data);
        return data;
      } catch (e) {
        console.error('Error adding task:', e);
        alert('Error adding task: ' + e.message);
      }
    }

    async function deleteTask(id) {
      try {
        const res = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
        if (!res.ok) throw new Error('Failed to delete task: ' + res.status);
        const data = await res.json();
        console.log('Task deleted successfully:', data);
        return data;
      } catch (e) {
        console.error('Error deleting task:', e);
        alert('Error deleting task: ' + e.message);
      }
    }

    async function loadTasks() {
      const tasks = await fetchTasks();
      const listEl = document.getElementById('task-list');
      listEl.innerHTML = '';
      tasks.forEach((taskObj) => {
        const li = document.createElement('li');
        li.textContent = taskObj.task;
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Remove';
        removeBtn.addEventListener('click', async () => {
          await deleteTask(taskObj.id);
          loadTasks();
        });
        li.appendChild(removeBtn);
        listEl.appendChild(li);
      });
    }

    document.getElementById('task-add').addEventListener('click', async () => {
      const inputEl = document.getElementById('task-input');
      const text = inputEl.value.trim();
      if (text) {
        await postTask(text);
        inputEl.value = '';
        loadTasks();
      }
    });

    // Initialise the task list when the page loads.
    loadTasks();

    // The media section now links to a private Google Drive folder rather than using
    // client-side password protection. No additional script is required here.
  </script>
</body>
</html>
